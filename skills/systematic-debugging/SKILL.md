---
name: systematic-debugging
description: 遇到任何 bug、测试失败或意外行为时使用，在提出修复方案之前必须先进行根因分析
triggers: ["systematic-debugging", "根因分析", "调试", "bug修复"]
---

# 系统化调试

## 铁律

**先分析，后修复。禁止在完成根因分析之前提出任何修复方案。**

## 4 阶段根因分析

### 阶段 1：重现（Reproduce）
```
□ 能稳定重现问题吗？
□ 最小重现步骤是什么？
□ 问题在哪个环境/条件下出现？
```

### 阶段 2：隔离（Isolate）
```
□ 问题出在哪个模块/函数/行？
□ 最近哪些变更可能引入了问题？（git log/diff）
□ 是否有相关的测试失败？
```

### 阶段 3：根因（Root Cause）
```
□ 为什么会发生这个问题？（不是"什么"，是"为什么"）
□ 根本原因是什么？（追溯到源头，不是症状）
□ 是否有其他地方存在相同问题？
```

### 阶段 4：修复方案（Fix）
```
□ 最小化修复方案是什么？
□ 修复是否会引入新问题？
□ 如何验证修复有效？
□ 是否需要添加测试防止回归？
```

## 输出格式

```
根本原因：[具体到文件:行号]
修复方案：[具体步骤]
验证方法：[如何确认修复有效]
预防措施：[添加什么测试/检查]
```

## 辅助参考文档

- `root-cause-tracing.md` — 调用链回溯技术（含真实案例）
- `condition-based-waiting.md` — 条件等待模式（替代 sleep）
- `defense-in-depth.md` — 多层防御策略
- `find-polluter.sh` — 测试污染源二分查找脚本

## 与 Axiom 集成

- 由 `axiom-implement` 在 `fail_count < 3` 时调用
- 分析结果传递给 debugger agent 执行修复
- 修复后重新运行验证，更新 `active_context.md`

## 禁止行为

- 在完成 4 阶段分析前提出修复
- 只修复症状不追溯根因
- 修复后不添加回归测试
