---
name: test-driven-development
description: 使用测试驱动开发实现任何功能或修复任何 bug，在编写实现代码之前必须先编写测试
triggers: ["test-driven-development", "tdd", "测试驱动", "先写测试"]
---

# 测试驱动开发

## 铁律

**先写测试，后写实现。在测试失败（红）之前，不得编写任何实现代码。**

违反此规则 = 删除已写的实现代码，从头开始。

## 红绿重构循环

```
红（RED）：写一个失败的测试
  ↓
绿（GREEN）：写最小代码使测试通过
  ↓
重构（REFACTOR）：改善代码质量，保持测试通过
  ↓
重复
```

## 每个任务的执行步骤

1. **理解验收标准** — 从 `manifest.md` 读取当前任务的验收标准
2. **写测试（红）** — 针对验收标准写测试，运行确认失败
3. **写实现（绿）** — 写最小代码使测试通过，运行确认通过
4. **重构** — 消除重复，改善可读性，保持测试通过
5. **提交** — 原子提交，消息格式：`test: T{N} + impl: {描述}`

## 测试原则

- 测试描述行为，不测试实现细节
- 每个测试只验证一件事
- 测试名称说明"在什么情况下期望什么结果"
- 边界条件和错误路径都要覆盖

## 常见借口（全部无效）

| 借口 | 现实 |
|------|------|
| "太简单了不需要测试" | 简单代码也会出错。测试只需 30 秒。 |
| "我先实现再补测试" | 补写的测试只验证"代码做了什么"，不验证"代码应该做什么" |
| "这是重构，不需要新测试" | 重构前必须有测试保护，否则不是重构是赌博 |
| "测试太难写了" | 难写的测试说明设计有问题，先改设计 |

## 辅助参考文档

- `testing-anti-patterns.md` — 5种常见测试反模式及修复方法

## 与 Axiom 集成

- 由 `axiom-implement` 在每个子任务执行前调用
- 测试结果作为 verifier agent 的验证证据
- 测试通过是子任务完成的必要条件（非充分条件）
