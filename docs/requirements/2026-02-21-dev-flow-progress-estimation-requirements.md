# 需求规格文档：dev-flow 阶段进度估算

**文档编号**：REQ-2026-02-21-001
**创建日期**：2026-02-21
**状态**：已确认

---

## 1. 用户故事

作为开发者，我希望在 axiom-status 仪表盘中看到当前所处的 dev-flow 阶段和整体完成百分比，以便快速了解项目进展。

---

## 2. 验收标准

| 编号 | 描述 |
|------|------|
| AC-1 | 正确识别并显示阶段名称（Phase 0 / Phase 1 / Phase 1.5 / Phase 2 / Phase 3 / REFLECTING） |
| AC-2 | 映射全部 6 个阶段；遇到未知值时显示"未知阶段"，不崩溃 |
| AC-3 | 完成百分比取当前阶段的累计完成度（含该阶段自身权重）；进入 Phase 1 显示 30%，进入 Phase 1.5 显示 40%；IDLE 显示 0%；范围 0–100% |
| AC-4 | 阶段权重集中定义在单一位置（单一数据源） |
| AC-5 | `status.py` 以纯文本两行输出：第一行 `当前阶段：<阶段名称>`，第二行 `完成进度：<整数>%`；降级时阶段名称为"未知阶段"，百分比为 0% |
| AC-6 | `active_context.md` 不存在或字段缺失时优雅降级，不抛出异常 |
| AC-7 | `task_status=IDLE` 时显示 0% |

---

## 3. 阶段权重定义

| 阶段标识 | 阶段名称 | 权重 | 累计完成度 |
|----------|----------|------|------------|
| Phase 0 | 需求理解 | 10% | 10% |
| Phase 1 | 需求起草 | 20% | 30% |
| Phase 1.5 | 专家评审 | 10% | 40% |
| Phase 2 | 任务拆解 | 15% | 55% |
| Phase 3 | 实现 | 40% | 95% |
| REFLECTING | 复盘沉淀 | 5% | 100% |

> 百分比含义：进入该阶段即视为该阶段权重已累计。IDLE 状态对应 0%。

---

## 4. `current_phase` 字段格式

`active_context.md` 中 `current_phase` 字段的示例值：

```
Phase 0 - Understanding
Phase 1 - Drafting
Phase 1.5 - Reviewing
Phase 2 - Decomposing
Phase 3 - Done
REFLECTING
```

解析规则：按阶段标识字符串长度降序排列后逐一前缀匹配（最长前缀优先），大小写不敏感。即 `"Phase 1.5"` 优先于 `"Phase 1"` 匹配，避免误判。

---

## 5. 技术约束

- 修改范围**仅限** `scripts/status.py`
- 不引入任何新的 pip 包
- 不修改 `active_context.md` 的数据结构

---

## 6. 排除范围

- 不做子任务细粒度进度追踪
- 不做历史趋势统计
- 权重为静态预定义，不支持运行时配置

---

## 7. 输出示例

```
当前阶段：Phase 1 - Drafting
完成进度：30%
```

降级示例（文件缺失或字段为空）：

```
当前阶段：未知阶段
完成进度：0%
```

---

## 8. 修订记录

| 日期 | 修订内容 | 澄清来源 |
|------|---------|---------|
| 2026-02-21 | H-1 澄清：进入阶段显示该阶段累计完成度（含自身权重）；进入 Phase 1 显示 30%，进入 Phase 1.5 显示 40% | analyst |
| 2026-02-21 | H-2 澄清：前缀匹配采用最长前缀优先算法，即 `"Phase 1.5"` 优先于 `"Phase 1"` 匹配 | analyst |
| 2026-02-21 | H-3 澄清：输出为纯文本两行格式，第一行 `当前阶段：<阶段名称>`，第二行 `完成进度：<整数>%` | analyst |
