---
description: Provider 路由规则（Axiom v4.2 + OMC MCP 融合）
version: 2.0
updated: 2026-02-21
---

# Provider Router

## 1. MCP 工具优先路由（只读分析任务）

只读分析任务优先使用 MCP 工具（更快更便宜）：

| 任务类型 | 首选 MCP | 降级方案 |
| :--- | :--- | :--- |
| 架构评审、计划验证、批判分析 | `mcp__x__ask_codex` (agent_role=architect/critic) | `Task(subagent_type="general-purpose", model="opus")` |
| UI/UX 设计、文档、大上下文 | `mcp__g__ask_gemini` (agent_role=designer/writer) | `Task(subagent_type="general-purpose", model="sonnet")` |

**使用前必须发现工具**：
```
ToolSearch("mcp")  # 发现所有 MCP 工具
# 若返回空 → MCP 未配置，直接使用 Claude agent 降级方案
```

**MCP 调用模式**：
```
# 前台（需要结果后继续）
mcp__x__ask_codex(prompt="...", agent_role="architect", context_files=["path1", "path2"])

# 后台（独立任务）
mcp__x__ask_codex(prompt="...", background=true)
job_id = result.job_id
# 稍后检查
mcp__x__check_job_status(job_id=job_id)
mcp__x__wait_for_job(job_id=job_id)
```

## 2. Claude Agent 路由（需要工具访问的任务）

以下任务必须使用 Claude agent（不可用 MCP 替代）：
- `executor`、`deep-executor`：需要写文件
- `debugger`：需要读文件、运行命令
- `verifier`：需要运行测试命令
- `build-fixer`：需要运行构建命令
- `explore`：需要文件系统访问

```
Task(
  subagent_type="general-purpose",
  model="sonnet",  # haiku/sonnet/opus 按复杂度选择
  prompt="你是{角色名}。{角色定义}\n\n任务：{具体任务}"
)
```

## 3. 回退策略

1. MCP 工具不可用 → 自动降级到对应 Claude agent
2. Claude agent 失败 → 记录错误，`fail_count += 1`
3. `fail_count >= 3` → `task_status: BLOCKED`
