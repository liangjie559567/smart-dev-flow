---
description: 核心路由规则 (v4.2 Axiom + OMC 融合) - 职责分离与流水线路由
---
# Axiom Router (v4.2)

## 0. 记忆优先原则（强制）

- **触发**：任何新 Session 的第一条请求，或用户说"继续"/"开始"/"早"
- **动作**：
  1. 静默读取 `.agent/memory/active_context.md`
  2. 检查 `task_status` 字段
  3. 注入 `Current Goal` 和 `Task Queues`
  4. 基于状态建议下一步

## 1. 核心流水线路由

| 用户意图 | 路由目标 | 阶段 |
| :--- | :--- | :--- |
| 提出新需求 / 做个功能 | `.agent/workflows/1-drafting.md` | Phase 1 需求澄清与架构设计 |
| Draft 已生成 / 评审 | `.agent/workflows/2-reviewing.md` | Phase 1.5 专家评审 |
| PRD 已确认 / 拆解 | `.agent/workflows/3-decomposing.md` | Phase 2 任务拆解 |
| Manifest 已确认 / 开发 | `.agent/workflows/4-implementing.md` | Phase 3 TDD 实现 |

## 2. 辅助功能路由

| 用户意图 | 路由目标 |
| :--- | :--- |
| 检测到报错 / "修个Bug" | `/smart-dev-flow:systematic-debugging` |
| "状态" / "进度" | 读取 `active_context.md` 输出当前状态 |
| "反思" / "总结" | `/smart-dev-flow:axiom-reflect` |
| "回滚" / "撤销" | 调用 `git-master` agent |

## 3. 门禁规则

- **模糊守卫**：需求模糊时强制反问，禁止直接进入 Drafting Phase
- **确认守卫**：
  - PRD 必须用户确认 → 才能进入 Phase 2
  - Manifest 必须用户确认 → 才能进入 Phase 3
- **CI 守卫**：所有代码提交前必须通过构建和测试

## 4. 状态感知路由

| task_status | 建议动作 |
| :--- | :--- |
| `IDLE` | 引导用户描述需求，触发 `/smart-dev-flow:dev-flow` |
| `DRAFTING` | 继续 Phase 1，调用 `1-drafting.md` |
| `REVIEWING` | 继续 Phase 1.5，调用 `2-reviewing.md` |
| `CONFIRMING` | 等待用户确认，展示当前阶段产出 |
| `DECOMPOSING` | 继续 Phase 2，调用 `3-decomposing.md` |
| `IMPLEMENTING` | 继续 Phase 3，调用 `axiom-implement` |
| `REFLECTING` | 执行 `axiom-reflect` |
| `BLOCKED` | 调用 `systematic-debugging` + `debugger` agent |

## 5. 进化引擎自动触发

| 触发事件 | 自动行为 |
| :--- | :--- |
| Phase 3 全部完成 | 自动触发 `axiom-reflect` |
| Bug 修复成功 | 自动 `axiom_harvest source_type=error_fix` |
| Session 结束 | 自动更新 `active_context.md` |
